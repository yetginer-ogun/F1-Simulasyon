<!doctype html>
<html lang="tr">
<head>
    <meta charset="utf-8">
    <title>F1 Şampiyonluğu Simülasyonu</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <!-- Flask static yolu -->
    <link rel="stylesheet" href="../static/css/style.css">
</head>
<body>
<div class="container">

    <header>
        <!-- Basit text logo, istersen buraya img eklersin -->
        <div class="logo">
            F1
        </div>
        <h1>F1 Şampiyonluk Simülasyonu</h1>
        <div class="small">
            — tabloyu düzenleyip kaydedebilir, ardından simülasyonu çalıştırabilirsiniz —
        </div>
    </header>

    <div class="card">
        <!-- Başlık ve "Yeni Sürücü Ekle" -->
        <div class="card-header">
            <div>
                <strong>Sürücüler</strong> — adı, puanı ve DNF olasılığını düzenleyin
            </div>
            <form action="{{ url_for('api_drivers') }}" method="post">
                <button class="btn-add" type="submit">Yeni Sürücü Ekle</button>
            </form>
        </div>

        <!-- Sürücü tablosu -->
        <div class="drivers-wrapper">
            <div class="drivers-header">
                <div>İsim</div>
                <div>Puan</div>
                <div>DNF (0-1)</div>
                <div class="text-center">ID</div>
                <div></div>
            </div>

            <div id="drivers-area">
                {% if all_data %}
                    {% for name, points, dnf, driver_id in all_data %}
                        <div class="driver-row">
                            <div>{{ name }}</div>
                            <div>{{ points }}</div>
                            <div>{{ dnf }}</div>
                            <div class="text-center">{{ driver_id }}</div>
                            <div class="text-center">
                                <form action="{{ url_for('api_update', id=driver_id) }}"
                                      method="post">
                                    <button type="submit" class="delete-btn">Sil</button>
                                </form>
                            </div>
                        </div>
                    {% endfor %}
                {% endif %}
            </div>
        </div>

        <!-- Kaydet / Simülasyon / Reset -->
        <div class="actions">
            <form action="{{ url_for('api_drivers') }}" method="post">
                <button class="btn-save" type="submit">Kaydet</button>
            </form>
            <form action="{{ url_for('api_simulate') }}" method="post">
                <button class="btn-sim" type="submit">Simülasyonu Çalıştır</button>
            </form>
            <form action="{{ url_for('api_reset') }}" method="post">
                <button type="submit">DB Sıfırla (varsayılanlar)</button>
            </form>
        </div>

        <!-- Kalan Yarışlar -->
        <div>
            <strong>Kalan Yarışlar</strong>
            <div class="races" id="races-area">
                {% if races_names %}
                    <ol>
                        {% for item in races_names %}
                            <li>{{ item[0] }}</li>
                        {% endfor %}
                    </ol>
                {% endif %}
            </div>
        </div>

            <!-- Yarış ekleme formu (inputs artık form içinde ve name'leri var) -->
            <form action="{{ url_for('api_races') }}" method="post" class="race-form">
                <input
                    type="text"
                    name="race_name"
                    id="race_name"
                    placeholder="Yarış adı">
                <label>
                    <input
                        type="checkbox"
                        name="is_sprint"
                        id="is_sprint">
                    sprint?
                </label>
                <button type="submit">Yarış Ekle</button>
            </form>
        </div>
    </div>

    <div class="results card" id="results">
    <h3>Simülasyon Sonuçları</h3>
    <div id="results-list">

        {% if probabilities %}
            <p>Her sürücünün şampiyon olma olasılığı:</p>

            <table>
                <thead>
                    <tr>
                        <th>Sıra</th>
                        <th>Sürücü</th>
                        <th>Şampiyonluk Olasılığı</th>
                    </tr>
                </thead>
                <tbody>
                    {# Olasılıklara göre büyükten küçüğe sırala #}
                    {% for driver, prob in probabilities|dictsort(false, 'value')|reverse %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ driver }}</td>
                            <td>
                                {{ (prob * 100)|round(2) }}%
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>Henüz bir simülasyon çalıştırılmadı.</p>
        {% endif %}

    </div>
</div>

    <div class="footer-note">
        Not: Simülasyon rastgelelik içerir. Simülasyon sayısı ve DNF olasılıklarına göre
        sonuçlar değişir.
    </div>

</div>
</body>
</html>
